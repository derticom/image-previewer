# image-preview

## Общее описание
Сервис **image-preview** - "Превьювер изображений" предназначен для изготовления preview (создания изображения
с новыми размерами на основе имеющегося JPEG-изображения).


## Архитектура
Сервис представляет собой web-сервер (прокси), загружающий изображения,
масштабирующий/обрезающий их до нужного формата и возвращающий пользователю.

## Основной обработчик
http://cut-service.com/fill/300/200/raw.githubusercontent.com/OtusGolang/final_project/master/examples/image-previewer/_gopher_original_1024x504.jpg

<---- микросервис ----><- размеры превью -><--------- URL исходного изображения --------------------------------->

В URL:
- http://cut-service.com/fill/300/200/ - endpoint сервиса,
  в котором 300x200 - это размеры финального изображения.
- https://raw.githubusercontent.com/OtusGolang/final_project/master/examples/image-previewer/_gopher_original_1024x504.jpg -
  адрес исходного изображения; сервис скачивает его, производит resize, кэширует и отдает клиенту.

Сервис получает URL исходного изображения, скачивает его, изменяет до необходимых размеров и возвращает как HTTP-ответ.


Проксируются все заголовки исходного HTTP запроса к целевому серверу.

Сервис кэширует полученное preview на локальном диске и при повторном запросе
отдает изображение с диска, без запроса к удаленному HTTP-серверу.

Для кэширования используется алгоритм **"Least Recent Used"**.

## Конфигурация
Конфигурирование сервиса осуществляется в yml файле:
```yml
log_level: "info"   # Уровень логирования.
cache_size: 10      # Размер кеша (кол-во изображений).
http_server:        # Параметры сервера: порт и таймаут.
  address: "localhost:8080"
  timeout: 30s
  ```

## Развертывание
Развертывание микросервиса осуществляется командой `make run`.